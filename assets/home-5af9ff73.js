import{d as F,g as H,r as g,a as m,o as h,c as b,b as p,e,w as o,f as v,F as U,h as O,t as C,u as $,i as Q,j as P,E as I,_ as j,k as E,p as B,l as R}from"./index-99272039.js";const N=F("comment",{state:()=>({doSearch:!1,commentOri:[],comment:[],lottery:[]}),getters:{},actions:{addLottery(w,r=1){this.lottery.push({item:w,num:r,edit:!1,winner:[]})}}}),J={style:{display:"flex"}},W={style:{"margin-top":"1rem"}},q={__name:"VideoSearch",setup(w){const{proxy:r}=H(),f=g(""),x=g(),y=g([]),d=N();function a(t,n=""){const l="https://youtube.googleapis.com/youtube/v3/commentThreads",_=new URLSearchParams({part:"snippet,replies",order:"time",videoId:t,maxResults:100,key:"AIzaSyCcMVAH6QQPVJ90bCzkWnPMljn3_-FsQ4U",pageToken:n}),V=`${l}?${_.toString()}`;return r.$axios.get(V).then(s=>{if(console.log(s.data.items),s.data.items.forEach(u=>{y.value.push(u.snippet.topLevelComment.snippet),d.commentOri.push(u.snippet.topLevelComment.snippet)}),s.data.nextPageToken)return a(t,s.data.nextPageToken);console.log("No more pages"),d.comment=d.commentOri}).catch(s=>{console.error(s)})}const i=function(){d.commentOri=[];const t=f.value;let n,l=!1;t.includes("youtube")?(n=t.split("v=")[1],l=!0):t.includes("youtu")?(n=t.split("youtu.be/")[1],l=!0):alert("網址錯誤"),l&&(d.doSearch=!0,x.value.src=`https://www.youtube.com/embed/${n}?origin=http://example.com`,r.$axios.get(`https://youtube.googleapis.com/youtube/v3/videos?part=snippet&id=${n}&key=AIzaSyCcMVAH6QQPVJ90bCzkWnPMljn3_-FsQ4U`).then(_=>{console.log(_.data)}).catch(_=>{console.error(_)}),a(n))};return(t,n)=>{const l=m("el-input"),_=m("el-button");return h(),b(U,null,[p("div",J,[e(l,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=V=>f.value=V),placeholder:"請輸入影片網址"},null,8,["modelValue"]),e(_,{onClick:i,type:"primary"},{default:o(()=>[v("搜尋")]),_:1})]),p("div",W,[p("iframe",{id:"ytplayer",ref_key:"ytplayer",ref:x,type:"text/html",width:"640",height:"360",src:"https://www.youtube.com/embed/M7lc1UVf-VE?origin=http://example.com",frameborder:"0"},null,512)])],64)}}},G=["innerHTML"],K={style:{display:"flex","justify-content":"center",margin:"1rem 0"}},X={__name:"commentTable",setup(w){const r=N(),{proxy:f}=H(),x=f.moment,y=g(1),d=g(10),a=t=>{d.value=t},i=O(()=>r.comment.slice((y.value-1)*d.value,y.value*d.value));return(t,n)=>{const l=m("el-table-column"),_=m("el-table"),V=m("el-pagination");return h(),b(U,null,[e(_,{data:i.value,style:{width:"100%"}},{default:o(()=>[e(l,{type:"index",label:"序號",width:"75"},{default:o(s=>[v(C(d.value*(y.value-1)+s.$index+1),1)]),_:1}),e(l,{prop:"authorDisplayName",label:"作者",width:"180"}),e(l,{prop:"textDisplay",label:"留言"},{default:o(s=>[p("p",{innerHTML:s.row.textDisplay},null,8,G)]),_:1}),e(l,{prop:"publishedAt",label:"發布時間",width:"180"},{default:o(s=>[v(C($(x)(s.row.publishedAt).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1},8,["data"]),p("div",K,[e(V,{"current-page":y.value,"onUpdate:currentPage":n[0]||(n[0]=s=>y.value=s),layout:"prev, pager, next, sizes","page-size":d.value,"page-sizes":[10,50,100],total:$(r).comment.length,onSizeChange:a},null,8,["current-page","page-size","total"])])],64)}}},Z=["innerHTML"],ee={__name:"lotteryList",setup(w){const r=N(),{proxy:f}=H(),x=f.moment;return(y,d)=>{const a=m("el-table-column"),i=m("el-table");return h(!0),b(U,null,Q($(r).lottery,(t,n)=>(h(),b("div",{key:n},[v(C(t.item)+" "+C(t.num)+"位 ",1),e(i,{data:t.winner,style:{width:"100%"}},{default:o(()=>[e(a,{type:"index",label:"序號",width:"75"},{default:o(l=>[v(C(l.$index+1),1)]),_:1}),e(a,{prop:"authorDisplayName",label:"中獎者",width:"180"}),e(a,{prop:"textDisplay",label:"留言"},{default:o(l=>[p("p",{innerHTML:l.row.textDisplay},null,8,Z)]),_:1}),e(a,{prop:"publishedAt",label:"發布時間",width:"180"},{default:o(l=>[v(C($(x)(l.row.publishedAt).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:2},1032,["data"])]))),128)}}},te=p("h3",null,"篩選區塊",-1),le=p("div",{style:{"white-space":"nowrap"}},"留言包含：",-1),ne=p("div",{style:{"white-space":"nowrap"}},"留言者：",-1),oe=p("div",{style:{"white-space":"nowrap"}},"時間區間：",-1),ae=p("h3",null,"獎項區塊",-1),se=p("div",{style:{"white-space":"nowrap"}},"獎品內容",-1),ue=p("div",{style:{"white-space":"nowrap"}},"抽取人數",-1),re={style:{display:"flex","align-items":"center"}},ce={key:0},de={key:1},ie={__name:"commentFilter",setup(w){const r=N(),{proxy:f}=H(),x=f.moment,y=g(""),d=g(""),a=g(null),i=function(){let s,u;a.value!==null&&(a.value[0]&&(s=a.value[0].getTime()),a.value[1]&&(u=x(a.value[1]).add(23,"h").add(59,"m").add(59,"s").add(999,"ms").format(),u=new Date(u).getTime())),r.comment=r.commentOri.filter(function(k,S,Y){const D=new Date(k.publishedAt).getTime(),L=k.textDisplay.includes(y.value)&&k.authorDisplayName.includes(d.value);if(s&&u){const T=D>=s&&D<=u;return L&&T}else return L})},t=g(""),n=g(1),l=function(){const s=r.lottery.map(u=>u.item);t.value===""?I({message:"請填寫獎項名稱",type:"warning"}):s.includes(t.value)?I({message:"已有此獎項名稱",type:"warning"}):r.addLottery(t.value,n.value)},_=function(s,u){r.lottery.splice(u,1)},V=function(s,u){s.edit=!s.edit};return(s,u)=>{const k=m("el-input"),S=m("el-col"),Y=m("el-date-picker"),D=m("el-row"),L=m("el-card"),T=m("el-input-number"),z=m("el-button");return h(),b(U,null,[e(L,null,{default:o(()=>[te,e(D,null,{default:o(()=>[e(S,{span:6,class:"flex-center-center"},{default:o(()=>[le,e(k,{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=c=>y.value=c),onChange:i,placeholder:"請輸入",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),e(S,{span:6,class:"flex-center-center"},{default:o(()=>[ne,e(k,{modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=c=>d.value=c),onChange:i,placeholder:"請輸入",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),e(S,{span:12,class:"flex-center-center"},{default:o(()=>[oe,e(Y,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=c=>a.value=c),type:"daterange","range-separator":"到","start-placeholder":"開始時間","end-placeholder":"結束時間",onChange:i},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{style:{"margin-top":"1rem"}},{default:o(()=>[ae,e(D,null,{default:o(()=>[e(S,{span:6,class:"flex-center-center"},{default:o(()=>[se,e(k,{modelValue:t.value,"onUpdate:modelValue":u[3]||(u[3]=c=>t.value=c),placeholder:"請輸入",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),e(S,{span:6,class:"flex-center-center"},{default:o(()=>[ue,e(T,{modelValue:n.value,"onUpdate:modelValue":u[4]||(u[4]=c=>n.value=c),min:1},null,8,["modelValue"])]),_:1}),e(z,{onClick:l,type:"primary"},{default:o(()=>[v("新增")]),_:1})]),_:1}),p("ul",null,[(h(!0),b(U,null,Q($(r).lottery,(c,A)=>(h(),b("li",{key:A,style:{"text-align":"left"}},[p("div",re,[c.edit?(h(),b("div",de,[e(k,{modelValue:c.item,"onUpdate:modelValue":M=>c.item=M,placeholder:"請輸入",style:{width:"30%"}},null,8,["modelValue","onUpdate:modelValue"]),e(T,{modelValue:c.num,"onUpdate:modelValue":M=>c.num=M,min:1},null,8,["modelValue","onUpdate:modelValue"]),v("位 ")])):(h(),b("div",ce,C(c.item)+" "+C(c.num)+"位 ",1)),c.edit?(h(),P(z,{key:3,onClick:M=>V(c,A),type:"primary"},{default:o(()=>[v("完成")]),_:2},1032,["onClick"])):(h(),P(z,{key:2,onClick:M=>V(c,A),type:"success"},{default:o(()=>[v("編輯")]),_:2},1032,["onClick"])),e(z,{onClick:M=>_(c,A),type:"danger"},{default:o(()=>[v("刪除")]),_:2},1032,["onClick"])])]))),128))])]),_:1})],64)}}};const me=w=>(B("data-v-6613d071"),w=w(),R(),w),pe=me(()=>p("div",{class:"header"},[p("h1",null,"Youtube 留言抽獎網站")],-1)),_e={key:0,style:{"margin-top":"1rem"}},ye={__name:"home",setup(w){const r=N(),f=g("first"),x=function(a){return Math.floor(Math.random()*a)},y=function(a,i){const t=[];let n=0;for(let l=0;l<i;l++)if(n=x(a),t.length<a)if(t.includes(n)){l-=1;continue}else t.push(n);return t},d=function(){let a=0;r.lottery.forEach((l,_)=>{a+=l.num});const i=y(r.comment.length,a);let t=0,n=0;console.log(i),r.lottery.forEach((l,_)=>{for(l.winner=[],t;t<n+l.num&&t<i.length;t++)l.winner.push(r.comment[i[t]]);n+=l.num}),f.value="second"};return(a,i)=>{const t=m("el-card"),n=m("el-button"),l=m("el-tab-pane"),_=m("el-tabs");return h(),b(U,null,[pe,p("div",null,[e(t,null,{default:o(()=>[e(q)]),_:1})]),$(r).doSearch?(h(),b("div",_e,[e(ie),$(r).lottery.length>0?(h(),P(n,{key:0,onClick:d,type:"danger"},{default:o(()=>[v("開始抽選")]),_:1})):E("",!0),e(_,{modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=V=>f.value=V)},{default:o(()=>[e(l,{label:"留言列表",name:"first"},{default:o(()=>[e(X)]),_:1}),e(l,{label:"中獎名單",name:"second"},{default:o(()=>[e(ee)]),_:1})]),_:1},8,["modelValue"])])):E("",!0)],64)}}},fe=j(ye,[["__scopeId","data-v-6613d071"]]);export{fe as default};
