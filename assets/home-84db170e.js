import{d as F,g as Y,r as b,a as _,o as p,c as V,b as y,e,w as l,f as g,F as M,h as O,t as S,u as k,i as Q,j as $,k as P,E,_ as R,p as j,l as B}from"./index-08d54605.js";const T=F("comment",{state:()=>({doSearch:!1,lotteryDone:!1,commentOri:[],comment:[],lottery:[]}),getters:{},actions:{addLottery(w,o=1){this.lottery.push({item:w,num:o,edit:!1,winner:[]})}}}),J={style:{display:"flex"}},W={class:"flex-center-center",style:{"margin-top":"1rem","align-items":"flex-start"}},q={__name:"VideoSearch",setup(w){const{proxy:o}=Y(),v=b(""),x=b(),h=b([]),d=T();function i(n,a=""){const t="https://youtube.googleapis.com/youtube/v3/commentThreads",r=new URLSearchParams({part:"snippet,replies",order:"time",videoId:n,maxResults:100,key:"AIzaSyCcMVAH6QQPVJ90bCzkWnPMljn3_-FsQ4U",pageToken:a}),f=`${t}?${r.toString()}`;return o.$axios.get(f).then(s=>{if(console.log(s.data.items),s.data.items.forEach(u=>{h.value.push(u.snippet.topLevelComment.snippet),d.commentOri.push(u.snippet.topLevelComment.snippet)}),s.data.nextPageToken)return i(n,s.data.nextPageToken);console.log("No more pages"),d.comment=d.commentOri}).catch(s=>{console.error(s)})}const m=function(){d.commentOri=[];const n=new URL(v.value),a=new URLSearchParams(n.search);let t,r=!1;n.hostname==="www.youtube.com"?(t=a.get("v"),r=!0):n.hostname==="youtu.be"?(t=n.pathname.substr(1),r=!0):alert("網址錯誤"),r&&(d.doSearch=!0,x.value.src=`https://www.youtube.com/embed/${t}?origin=http://example.com`,o.$axios.get(`https://youtube.googleapis.com/youtube/v3/videos?part=snippet&id=${t}&key=AIzaSyCcMVAH6QQPVJ90bCzkWnPMljn3_-FsQ4U`).then(f=>{console.log(f.data)}).catch(f=>{console.error(f)}),i(t))};return(n,a)=>{const t=_("el-input"),r=_("el-button");return p(),V(M,null,[y("div",J,[e(t,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=f=>v.value=f),placeholder:"請輸入影片網址"},null,8,["modelValue"]),e(r,{onClick:m,type:"primary"},{default:l(()=>[g("搜尋")]),_:1})]),y("div",W,[y("iframe",{id:"ytplayer",ref_key:"ytplayer",ref:x,type:"text/html",width:"640",height:"360",src:"https://www.youtube.com/embed/M7lc1UVf-VE?origin=http://example.com",frameborder:"0"},null,512)])],64)}}},G=["innerHTML"],K={style:{display:"flex","justify-content":"center",margin:"1rem 0"}},X={__name:"commentTable",setup(w){const o=T(),{proxy:v}=Y(),x=v.moment,h=b(1),d=b(10),i=n=>{d.value=n},m=O(()=>o.comment.slice((h.value-1)*d.value,h.value*d.value));return(n,a)=>{const t=_("el-table-column"),r=_("el-table"),f=_("el-pagination");return p(),V(M,null,[e(r,{data:m.value,style:{width:"100%"}},{default:l(()=>[e(t,{type:"index",label:"序號",width:"75"},{default:l(s=>[g(S(d.value*(h.value-1)+s.$index+1),1)]),_:1}),e(t,{prop:"authorDisplayName",label:"作者",width:"180"}),e(t,{prop:"textDisplay",label:"留言"},{default:l(s=>[y("p",{innerHTML:s.row.textDisplay},null,8,G)]),_:1}),e(t,{prop:"publishedAt",label:"發布時間",width:"180"},{default:l(s=>[g(S(k(x)(s.row.publishedAt).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1},8,["data"]),y("div",K,[e(f,{"current-page":h.value,"onUpdate:currentPage":a[0]||(a[0]=s=>h.value=s),layout:"prev, pager, next, sizes","page-size":d.value,"page-sizes":[10,50,100],total:k(o).comment.length,onSizeChange:i},null,8,["current-page","page-size","total"])])],64)}}},Z=["innerHTML"],ee={__name:"lotteryList",setup(w){const o=T(),{proxy:v}=Y(),x=v.moment;return(h,d)=>{const i=_("el-table-column"),m=_("el-table");return p(!0),V(M,null,Q(k(o).lottery,(n,a)=>(p(),V("div",{key:a,style:{"margin-bottom":"1rem"}},[y("h2",null,S(n.item)+" "+S(n.num)+"位",1),e(m,{data:n.winner,style:{width:"100%"}},{default:l(()=>[e(i,{type:"index",label:"序號",width:"75"},{default:l(t=>[g(S(t.$index+1),1)]),_:1}),e(i,{prop:"authorDisplayName",label:"中獎者",width:"180"}),e(i,{prop:"textDisplay",label:"留言"},{default:l(t=>[y("p",{innerHTML:t.row.textDisplay},null,8,Z)]),_:1}),e(i,{prop:"publishedAt",label:"發布時間",width:"180"},{default:l(t=>[g(S(k(x)(t.row.publishedAt).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:2},1032,["data"])]))),128)}}},te=y("h3",null,"篩選區塊",-1),le=y("div",{style:{"white-space":"nowrap"}},"留言包含：",-1),ne=y("div",{style:{"white-space":"nowrap"}},"留言者：",-1),oe=y("div",{style:{"white-space":"nowrap"}},"時間區間：",-1),ae=y("h3",null,"獎項區塊",-1),se=y("div",{style:{"white-space":"nowrap"}},"獎品內容",-1),re=y("div",{style:{"white-space":"nowrap"}},"抽取人數",-1),ue={__name:"commentFilter",setup(w){const o=T(),{proxy:v}=Y(),x=v.moment,h=b(""),d=b(""),i=b(null),m=function(){let s,u;i.value!==null&&(i.value[0]&&(s=i.value[0].getTime()),i.value[1]&&(u=x(i.value[1]).add(23,"h").add(59,"m").add(59,"s").add(999,"ms").format(),u=new Date(u).getTime())),o.comment=o.commentOri.filter(function(D,C,I){const L=new Date(D.publishedAt).getTime(),N=D.textDisplay.includes(h.value)&&D.authorDisplayName.includes(d.value);if(s&&u){const z=L>=s&&L<=u;return N&&z}else return N})},n=b(""),a=b(1),t=function(){const s=o.lottery.map(u=>u.item);n.value===""?E({message:"請填寫獎項名稱",type:"warning"}):s.includes(n.value)?E({message:"已有此獎項名稱",type:"warning"}):o.addLottery(n.value,a.value)},r=function(s,u){o.lottery.splice(u,1)},f=function(s,u){s.edit=!s.edit};return(s,u)=>{const D=_("el-input"),C=_("el-col"),I=_("el-date-picker"),L=_("el-row"),N=_("el-card"),z=_("el-input-number"),A=_("el-button");return p(),V(M,null,[e(N,null,{default:l(()=>[te,e(L,null,{default:l(()=>[e(C,{span:12,class:"flex-left-center"},{default:l(()=>[le,e(D,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=c=>h.value=c),onChange:m,placeholder:"請輸入",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),e(C,{span:12,class:"flex-left-center"},{default:l(()=>[ne,e(D,{modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=c=>d.value=c),onChange:m,placeholder:"請輸入",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),e(C,{span:12,class:"flex-left-center",style:{"margin-top":".5rem"}},{default:l(()=>[oe,e(I,{modelValue:i.value,"onUpdate:modelValue":u[2]||(u[2]=c=>i.value=c),type:"daterange","range-separator":"到","start-placeholder":"開始時間","end-placeholder":"結束時間",onChange:m},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(N,{style:{"margin-top":"1rem"}},{default:l(()=>[ae,e(L,null,{default:l(()=>[e(C,{span:6,class:"flex-center-center"},{default:l(()=>[se,e(D,{modelValue:n.value,"onUpdate:modelValue":u[3]||(u[3]=c=>n.value=c),placeholder:"請輸入",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),e(C,{span:6,class:"flex-center-center"},{default:l(()=>[re,e(z,{modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=c=>a.value=c),min:1},null,8,["modelValue"])]),_:1}),k(o).lotteryDone?P("",!0):(p(),$(A,{key:0,onClick:t,type:"primary"},{default:l(()=>[g("新增")]),_:1}))]),_:1}),y("ul",null,[(p(!0),V(M,null,Q(k(o).lottery,(c,H)=>(p(),V("li",{key:H,style:{"text-align":"left"}},[e(L,{style:{display:"flex","align-items":"center","margin-top":".5rem"}},{default:l(()=>[c.edit?(p(),$(C,{key:1,span:18},{default:l(()=>[e(D,{modelValue:c.item,"onUpdate:modelValue":U=>c.item=U,placeholder:"請輸入",style:{width:"30%","margin-right":".5rem"}},null,8,["modelValue","onUpdate:modelValue"]),e(z,{modelValue:c.num,"onUpdate:modelValue":U=>c.num=U,min:1},null,8,["modelValue","onUpdate:modelValue"]),g("位 ")]),_:2},1024)):(p(),$(C,{key:0,span:18},{default:l(()=>[g(S(c.item)+" "+S(c.num)+"位 ",1)]),_:2},1024)),k(o).lotteryDone?P("",!0):(p(),$(C,{key:2,span:6},{default:l(()=>[c.edit?(p(),$(A,{key:1,onClick:U=>f(c,H),type:"primary"},{default:l(()=>[g("完成")]),_:2},1032,["onClick"])):(p(),$(A,{key:0,onClick:U=>f(c,H),type:"success"},{default:l(()=>[g("編輯")]),_:2},1032,["onClick"])),e(A,{onClick:U=>r(c,H),type:"danger"},{default:l(()=>[g("刪除")]),_:2},1032,["onClick"])]),_:2},1024))]),_:2},1024)]))),128))])]),_:1})],64)}}};const ce=w=>(j("data-v-4bfeb9d3"),w=w(),B(),w),ie=ce(()=>y("div",{class:"header"},[y("h1",null,"Youtube 留言抽獎網站")],-1)),de={key:0,style:{"margin-top":"1rem"}},me={key:0},pe={__name:"home",setup(w){const o=T(),v=b("first"),x=function(m){return Math.floor(Math.random()*m)},h=function(m,n){const a=[];let t=0;for(let r=0;r<n;r++)if(t=x(m),a.length<m)if(a.includes(t)){r-=1;continue}else a.push(t);return a},d=function(){let m=0;o.lottery.forEach((r,f)=>{m+=r.num});const n=h(o.comment.length,m);let a=0,t=0;console.log(n),o.lottery.forEach((r,f)=>{for(r.winner=[],a;a<t+r.num&&a<n.length;a++)r.winner.push(o.comment[n[a]]);t+=r.num}),v.value="second",o.lotteryDone=!0},i=function(){o.lotteryDone=!1};return(m,n)=>{const a=_("el-card"),t=_("el-button"),r=_("el-tab-pane"),f=_("el-tabs");return p(),V(M,null,[ie,y("div",null,[e(a,null,{default:l(()=>[e(q)]),_:1})]),k(o).doSearch?(p(),V("div",de,[e(ue),k(o).lottery.length>0?(p(),V("div",me,[k(o).lotteryDone?(p(),$(t,{key:1,onClick:i,type:"success"},{default:l(()=>[g("重新抽選")]),_:1})):(p(),$(t,{key:0,onClick:d,type:"danger"},{default:l(()=>[g("開始抽選")]),_:1}))])):P("",!0),e(f,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=s=>v.value=s)},{default:l(()=>[e(r,{label:"留言列表",name:"first"},{default:l(()=>[e(X)]),_:1}),e(r,{label:"中獎名單",name:"second"},{default:l(()=>[e(ee)]),_:1})]),_:1},8,["modelValue"])])):P("",!0)],64)}}},ye=R(pe,[["__scopeId","data-v-4bfeb9d3"]]);export{ye as default};
